{{- if .Values.gitSync.enabled }}

{{- /* Create secrets for sshKeys entries that have inline privateKey */ -}}
{{- range $idx, $sshKeyEntry := .Values.sshKeys }}
{{- if $sshKeyEntry.privateKey }}
{{- $secretName := $sshKeyEntry.secretName | default (printf "%s-%s" (include "oxy-app.fullname" $) $sshKeyEntry.name) }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ $secretName }}
  namespace: {{ $.Release.Namespace }}
  labels:
    {{- include "oxy-app.labels" $ | nindent 4 }}
type: Opaque
data:
  ssh: {{ $sshKeyEntry.privateKey | b64enc | quote }}
  {{- if $sshKeyEntry.knownHosts }}
  known_hosts: {{ $sshKeyEntry.knownHosts | b64enc | quote }}
  {{- else }}
  # Default known_hosts for common Git hosting services
  # Users should provide their own for production use
  known_hosts: {{ "github.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMqqnkVzrm0SdG6UOoqKLsabgH5C9okWi0dh2l9GKJl\ngithub.com ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg=\ngithub.com ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCj7ndNxQowgcQnjshcLrqPEiiphnt+VTTvDP6mHBL9j1aNUkY4Ue1gvwnGLVlOhGeYrnZaMgRK6+PKCUXaDbC7qtbW8gIkhL7aGCsOr/C56SJMy/BCZfxd1nWzAOxSDPgVsmerOBYfNqltV9/hWCqBywINIR+5dIg6JTJ72pcEpEjcYgXkE2YEFXV1JHnsKgbLWNlhScqb2UmyRkQyytRLtL+38TGxkxCflmO+5Z8CSSNY7GidjMIZ7Q4zMjA2n1nGrlTDkzwDCsw+wqFPGQA1j0N9PBpQSIvZT8vXsHBk65vGVfL5CTXT2jPgAz5hWjCRgXSW0xHhJeZJ8Hp6iHN+iu+3HbGXLnXcZFGvOVnVFIK5YNUvqCLpkS2DV6ahhH+d3qBMCJOjsLJLU7qDWABWfzRjJ1dSGUJxl7s/ujYBcz8MdI7RvOwNmE9v8wKmJzGnmWrp6ykJF9vMGTYXc7/I7BIlFxXQnQ9pGlZS6yFLnwHYLWqHCVfgNXlWQf7eSvU=\ngitlab.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAfuCHKVTjquxvt6CM6tdG4SLp1Btn/nOeHHE5UOzRdf\ngitlab.com ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCsj2bNKTBSpIYDEGk9KxsGh3mySTRgMtXL583qmBpzeQ+jqCMRgBqB98u3z++J1sKlXHWfM9dyhSevkMwSbhoR8XIq/U0tCNyokEi/ueaBMCvbcTHhO7FcwzY92WK4Yt0aGROY5qX2UKSeOvuP4D6TPqKF1onrSzH9bx9XUf2lEdWT/ia1NEKjunUqu1xOB/StKDHMoX4/OKyIzuS0q/T1zOATthvasJFoPrAjkohTyaDUz2LN5JoH839hViyEG82yB+MjcFV5MU3N1l1yfIDnQbqn72C5/CZ2ulFqLbS0yG3fQXCCiPLcUABLwq7HAiMJ5IW5aVGvx5xJqHqm7sNr\ngitlab.com ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFSMqzJeV9rUzU4kWitGjeR4PWSa29SPqJ1fVkhtj3Hw9xjLVXVYrU9QlYWrOLXBpQ6KWjbjTDTdDkoohFzgbEY=\nbitbucket.org ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDQeJzhupRu0u0cdegZIa8e86EG2qOCsIsD1Xw0xSeiPDlCr7kq97NLmMbpKTX6Esc30NuoqEEHCuc7yWtwp8dI76EEEB1VqY9QJq6vk+aySyboD5QF61I/1WeTwu+deCbgKMGbUijeXhtfbxSxm6JwGrXrhBdofTsbKRUsrN1WoNgUa8uqN1Vx6WAJw1JHPhglEGGHea6QICwJOAr/6mrui/oB7pkaWKHj3z7d1IC4KWLtY47lvqzYTHgIy9Y+R/aW/3HAUiXzU0OuXiOHJfL0G3m8+7VezZ6dM1FW8C9lUhBzLiBzCK3UL7iEJnVb5iL6KdPBqNH4Ej0yZyPOvd6qCvgYPKGLnYTFmP+RLy5O7UhN0bUJCiLdqLd1sqDr8hHJGcP8CJJLCqFxq6Mw4JcR+0V5nVe6d4Qkh1qcRx8y8nU1p7qSdZqIj2zZCQU1Q7N0y6+6U5fZCR3bLfQsN0z8X5Q8F8W8J8L0Q8j+K8w8S8m0H8v0h8N0E8L0U3V8p8b" | b64enc | quote }}
  {{- end }}
{{- end }}
{{- end }}

{{- /* DEPRECATED: Legacy single sshKey support for backward compatibility */ -}}
{{- if and (or .Values.sshKey.privateKey .Values.sshKey.publicKey) (eq (len .Values.sshKeys) 0) }}
{{- $secretName := default .Values.gitSync.sshSecretName .Values.sshKey.secretName }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ $secretName }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "oxy-app.labels" . | nindent 4 }}
    deprecated: "true"
    migration: "Use sshKeys instead"
type: Opaque
data:
  {{- if .Values.sshKey.privateKey }}
  ssh: {{ .Values.sshKey.privateKey | b64enc | quote }}
  {{- end }}
  {{- if .Values.sshKey.knownHosts }}
  known_hosts: {{ .Values.sshKey.knownHosts | b64enc | quote }}
  {{- else }}
  # Default known_hosts for common Git hosting services
  # Users should provide their own for production use
  known_hosts: {{ "github.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMqqnkVzrm0SdG6UOoqKLsabgH5C9okWi0dh2l9GKJl\ngithub.com ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg=\ngithub.com ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCj7ndNxQowgcQnjshcLrqPEiiphnt+VTTvDP6mHBL9j1aNUkY4Ue1gvwnGLVlOhGeYrnZaMgRK6+PKCUXaDbC7qtbW8gIkhL7aGCsOr/C56SJMy/BCZfxd1nWzAOxSDPgVsmerOBYfNqltV9/hWCqBywINIR+5dIg6JTJ72pcEpEjcYgXkE2YEFXV1JHnsKgbLWNlhScqb2UmyRkQyytRLtL+38TGxkxCflmO+5Z8CSSNY7GidjMIZ7Q4zMjA2n1nGrlTDkzwDCsw+wqFPGQA1j0N9PBpQSIvZT8vXsHBk65vGVfL5CTXT2jPgAz5hWjCRgXSW0xHhJeZJ8Hp6iHN+iu+3HbGXLnXcZFGvOVnVFIK5YNUvqCLpkS2DV6ahhH+d3qBMCJOjsLJLU7qDWABWfzRjJ1dSGUJxl7s/ujYBcz8MdI7RvOwNmE9v8wKmJzGnmWrp6ykJF9vMGTYXc7/I7BIlFxXQnQ9pGlZS6yFLnwHYLWqHCVfgNXlWQf7eSvU=\ngitlab.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAfuCHKVTjquxvt6CM6tdG4SLp1Btn/nOeHHE5UOzRdf\ngitlab.com ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCsj2bNKTBSpIYDEGk9KxsGh3mySTRgMtXL583qmBpzeQ+jqCMRgBqB98u3z++J1sKlXHWfM9dyhSevkMwSbhoR8XIq/U0tCNyokEi/ueaBMCvbcTHhO7FcwzY92WK4Yt0aGROY5qX2UKSeOvuP4D6TPqKF1onrSzH9bx9XUf2lEdWT/ia1NEKjunUqu1xOB/StKDHMoX4/OKyIzuS0q/T1zOATthvasJFoPrAjkohTyaDUz2LN5JoH839hViyEG82yB+MjcFV5MU3N1l1yfIDnQbqn72C5/CZ2ulFqLbS0yG3fQXCCiPLcUABLwq7HAiMJ5IW5aVGvx5xJqHqm7sNr\ngitlab.com ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFSMqzJeV9rUzU4kWitGjeR4PWSa29SPqJ1fVkhtj3Hw9xjLVXVYrU9QlYWrOLXBpQ6KWjbjTDTdDkoohFzgbEY=\nbitbucket.org ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDQeJzhupRu0u0cdegZIa8e86EG2qOCsIsD1Xw0xSeiPDlCr7kq97NLmMbpKTX6Esc30NuoqEEHCuc7yWtwp8dI76EEEB1VqY9QJq6vk+aySyboD5QF61I/1WeTwu+deCbgKMGbUijeXhtfbxSxm6JwGrXrhBdofTsbKRUsrN1WoNgUa8uqN1Vx6WAJw1JHPhglEGGHea6QICwJOAr/6mrui/oB7pkaWKHj3z7d1IC4KWLtY47lvqzYTHgIy9Y+R/aW/3HAUiXzU0OuXiOHJfL0G3m8+7VezZ6dM1FW8C9lUhBzLiBzCK3UL7iEJnVb5iL6KdPBqNH4Ej0yZyPOvd6qCvgYPKGLnYTFmP+RLy5O7UhN0bUJCiLdqLd1sqDr8hHJGcP8CJJLCqFxq6Mw4JcR+0V5nVe6d4Qkh1qcRx8y8nU1p7qSdZqIj2zZCQU1Q7N0y6+6U5fZCR3bLfQsN0z8X5Q8F8W8J8L0Q8j+K8w8S8m0H8v0h8N0E8L0U3V8p8b" | b64enc | quote }}
  {{- end }}
{{- end }}

{{- end }}
