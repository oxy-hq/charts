suite: statefulset-externalsecret
templates:
  - statefulset.yaml

tests:
  - it: injects envFrom secretRef when externalSecrets.envSecretNames provided
    values:
      - values-externalsecret.yaml
    asserts:
      - contains:
          path: spec.template.spec.containers[0].envFrom
          content:
            secretRef:
              name: my-env-secret

  - it: mounts secret volumes for env and file secrets
    values:
      - values-externalsecret.yaml
    asserts:
      - contains:
          path: spec.template.spec.volumes
          content:
            name: env-secret-0
            secret:
              optional: true
              secretName: my-env-secret
      - contains:
          path: spec.template.spec.volumes
          content:
            name: file-secret-0
            secret:
              optional: true
              secretName: my-file-secret
