# Default values for oxy (self-contained with Docker-in-Docker)
# All services (PostgreSQL, ClickHouse, OTel, etc.) are managed by `oxy start`
# inside the DinD sidecar â€” no external dependencies required.

# Application configuration
name: oxy-start

app:
  image: ghcr.io/oxy-hq/oxy
  imageTag: ""
  port: 3000
  replicaCount: 1
  imagePullPolicy: IfNotPresent
  # Override the container command. When empty, the chart runs:
  #   oxy start [--enterprise] && oxy serve [--cloud]
  command: []

# Docker-in-Docker sidecar configuration
dind:
  enabled: true
  image: docker
  imageTag: "27-dind"
  imagePullPolicy: IfNotPresent
  # Storage for Docker data (images, containers, volumes)
  storageSize: 40Gi
  storageClassName: ""
  # Resources for the DinD daemon
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 2000m
      memory: 4Gi

# oxy start configuration
# The 'oxy start' command automatically starts PostgreSQL (and optionally ClickHouse, OTel, etc.)
# inside the DinD sidecar via Docker API (tcp://localhost:2375)
# Note: DinD needs ~10-15s to fully initialize before oxy start can pull images and create containers
oxyStart:
  # Run oxy start --enterprise (adds ClickHouse, OTel Collector, Cube.js)
  enterprise: false
  # Run oxy start --clean on every pod start (removes existing containers/volumes first)
  clean: false

# Ingress configuration
ingress:
  enabled: false
  ingressClassName: ""
  annotations: {}
  path: /
  pathType: Prefix
  hosts:
    - host: chart-example.local
      paths: []
  tls: []

# Resource configuration for the oxy container
resources:
  requests:
    cpu: 250m
    memory: 512Mi
  limits:
    cpu: 1000m
    memory: 2Gi

# Environment variables
env:
  OXY_STATE_DIR: /workspace/oxy_data

configMap:
  enabled: false
  data: {}

# Service Account
serviceAccount:
  create: true
  name: ""
  annotations: {}

# Persistent storage for workspace
persistence:
  enabled: true
  storageClassName: ""
  size: 20Gi
  accessMode: ReadWriteOnce
  mountPath: /workspace
  folder: oxy_data
  annotations: {}
  labels: {}
  volumeMode: Filesystem
  selector: {}

# Node selection and tolerations
nodeSelector:

tolerations:

affinity: {}

# Service configuration
service:
  type: ClusterIP
  port: 80
  targetPort: 3000
  name: ""

# Headless service for StatefulSet
headlessService:
  enabled: true

# Probes configuration
livenessProbe:
  httpGet:
    path: /
    port: 3000
  initialDelaySeconds: 60
  periodSeconds: 30
  timeoutSeconds: 10
  failureThreshold: 5

readinessProbe:
  httpGet:
    path: /
    port: 3000
  initialDelaySeconds: 60
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 5

# Security context
securityContext:
  fsGroup: 1000

# External secrets configuration
externalSecrets:
  create: false
  envSecretNames: []
  envSecretMappings: {}
  fileSecrets: []
  storeRef:
    name: ""
    kind: ""

# SSH key configuration for git-sync
sshKey:
  secretName: ""
  privateKey: ""
  knownHosts: ""

# Git sync configuration
gitSync:
  period: 15s
  repository: ""
  branch: main
  sshSecretName: oxy-git-ssh
  enabled: false
  root: ""
  link: ""
  workingDir: ""
  imagePullPolicy: IfNotPresent
  githubApp:
    secretName: ""
    privateKey: ""
    applicationId: ""
    installationId: ""
    privateKeyKey: "github_app_private_key"
    applicationIdKey: "github_app_application_id"
    installationIdKey: "github_app_installation_id"

# HTTP authentication for git-sync
httpAuth:
  username: ""
  password: ""
  secretName: ""
  passwordKey: "password"

# Extra containers
extraInitContainers: []
extraSidecars: []

# PodDisruptionBudget
pdb:
  enabled: false
  minAvailable: ""
  maxUnavailable: ""
  selector: {}

# Name overrides
nameOverride: ""
fullnameOverride: ""
